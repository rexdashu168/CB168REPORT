<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rex æŠ•è³‡æ±ºç­– (å¤§å­—é«”å„ªåŒ–ç‰ˆ)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
    :root {
        --bg-body: #f2f4f7;
        --card-bg: #ffffff;
        --primary: #4f46e5;
        --text-dark: #111827;
        --text-gray: #4b5563;
        --shadow-card: 0 4px 12px rgba(0,0,0,0.08);
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "PingFang TC", "Microsoft JhengHei", sans-serif;
        background: var(--bg-body);
        color: var(--text-dark);
        margin: 0;
        padding-bottom: 110px; /* åº•éƒ¨ç•™ç™½å¢åŠ ï¼Œé¿å…æ“‹ä½å…§å®¹ */
        -webkit-tap-highlight-color: transparent;
    }

    .view { display: none; min-height: 100vh; }
    .view.active { display: block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* === 1. Header (å­—é«”åŠ å¤§) === */
    .header-container {
        background: #fff;
        position: sticky; top: 0; z-index: 100;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        padding-bottom: 8px;
    }
    .header-top {
        padding: 16px 20px 12px; 
        display: flex; justify-content: space-between; align-items: center;
    }
    .app-title { 
        font-size: 32px; /* åŠ å¤§ */
        font-weight: 900; 
        color: #111827; 
        letter-spacing: -0.5px;
    }
    .status-badge { 
        font-size: 14px; /* åŠ å¤§ */
        background: #ecfdf5; color: #047857; 
        padding: 6px 12px; border-radius: 12px; font-weight: 600;
    }

    /* æ©«å‘æ²å‹•åŠŸèƒ½åˆ— */
    .nav-scroll {
        display: flex; gap: 12px; padding: 4px 20px 16px; 
        overflow-x: auto; scrollbar-width: none;
    }
    .nav-scroll::-webkit-scrollbar { display: none; }
    
    .nav-pill {
        flex-shrink: 0; padding: 10px 20px; /* åŠ å¤§æŒ‰éˆ• */
        background: #f3f4f6; border-radius: 24px;
        font-size: 15px; /* åŠ å¤§ */
        font-weight: 600; color: #4b5563; cursor: pointer; transition: 0.2s;
    }
    .nav-pill.active { background: #111827; color: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .nav-pill.highlight { background: #fff1f2; color: #e11d48; border: 1px solid #fecdd3; }

    /* === 2. é¦–é å¤§æ–¹å¡Š (Masonry Grid) === */
    .masonry-grid {
        padding: 20px;
        display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
    }
    
    .summary-card {
        background: #fff; border-radius: 20px; padding: 20px;
        box-shadow: var(--shadow-card); cursor: pointer;
        display: flex; flex-direction: column; justify-content: space-between;
        height: 220px; /* åŠ é«˜ä»¥å®¹ç´å¤§å­—é«” */
        border: 1px solid rgba(0,0,0,0.02); position: relative;
        transition: transform 0.1s;
    }
    .summary-card:active { transform: scale(0.98); }

    .sc-head { margin-bottom: 10px; }
    
    .sc-comp { 
        font-size: 24px; /* åŠ å¤§ */
        font-weight: 800; color: #111827; line-height: 1.2;
    }
    .sc-code { font-size: 15px; color: #9ca3af; display: block; margin-top: 4px; font-weight: 500; }
    
    .sc-rating { 
        position: absolute; top: 20px; right: 20px; 
        font-size: 14px; font-weight: 700; padding: 6px 12px; border-radius: 8px;
    }
    .bg-buy { background: #fee2e2; color: #ef4444; }
    .bg-hold { background: #ffedd5; color: #c2410c; }

    .sc-body { 
        font-size: 16px; /* åŠ å¤§ */
        color: #374151; line-height: 1.5; font-weight: 500;
        overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;
    }
    .sc-foot { 
        margin-top: auto; padding-top: 14px; border-top: 1px solid #f3f4f6;
        font-size: 13px; /* åŠ å¤§ */
        color: #6b7280; display: flex; justify-content: space-between; font-weight: 500;
    }

    /* === 3. è©³æƒ…é  (å­—é«”åŠ å¤§) === */
    .chat-flow-container {
        max-width: 600px; margin: 0 auto; padding: 20px;
        display: flex; flex-direction: column; gap: 20px;
    }

    .chat-box {
        background: #fff; border-radius: 18px; padding: 26px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        opacity: 0; animation: slideUp 0.4s forwards;
        border-left: 6px solid transparent;
    }
    @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .box-meta { border-left-color: #4f46e5; }
    .box-rex { background: #fffbeb; border: 1px solid #fcd34d; }
    .box-qa { background: #f0fdf4; border: 1px solid #bbf7d0; }

    .box-label {
        font-size: 14px; /* åŠ å¤§ */
        font-weight: 800; color: #9ca3af; text-transform: uppercase; 
        margin-bottom: 12px; display: flex; align-items: center; gap: 8px; letter-spacing: 0.5px;
    }
    .box-content {
        font-size: 18px; /* æ ¸å¿ƒå…§å®¹åŠ å¤§ */
        line-height: 1.8; color: #1f2937; white-space: pre-line;
    }

    /* === åˆ—è¡¨èˆ‡å…¶ä»– === */
    .list-container { padding: 20px; }
    .list-row {
        background: #fff; padding: 24px; border-radius: 18px; margin-bottom: 16px;
        box-shadow: var(--shadow-card); display: flex; justify-content: space-between; align-items: center;
    }

    /* === æ‡¸æµ®è¿”å›æŒ‰éˆ• (ä½ç½®ä¿®æ­£) === */
    .fab-back {
        position: fixed; 
        bottom: 100px; /* é‡è¦ä¿®æ”¹ï¼šä¸Šç§»è‡³ 100pxï¼Œé¿é–‹åº•éƒ¨å°èˆª */
        right: 24px; z-index: 999;
        width: 60px; height: 60px; 
        background: #111827; color: white;
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-size: 30px; box-shadow: 0 6px 20px rgba(0,0,0,0.3); cursor: pointer;
        transition: transform 0.2s;
    }
    .fab-back:active { transform: scale(0.9); }

    /* === åº•éƒ¨å°èˆª (å››æ ¼å°ç¨±) === */
    .bottom-nav {
        position: fixed; bottom: 0; width: 100%; background: #fff; border-top: 1px solid #e5e7eb;
        display: flex; justify-content: space-around; padding: 14px 0; z-index: 90;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
    }
    .bn-item { 
        flex: 1; text-align: center; cursor: pointer; 
        color: #9ca3af; font-size: 12px; font-weight: 600;
    }
    .bn-item.active { color: #4f46e5; }
    .bn-icon { font-size: 26px; display: block; margin-bottom: 4px; }

</style>
</head>
<body>

<div id="homeView" class="view active">
    <div class="header-container">
        <div class="header-top">
            <div class="app-title">Rex æŠ•è³‡æ±ºç­–</div>
            <div id="db-status" class="status-badge">æ¸¬è©¦è³‡æ–™</div>
        </div>
        <div class="nav-scroll">
            <div class="nav-pill active" onclick="app.filter('all', this)">å…¨éƒ¨</div>
            <div class="nav-pill highlight" onclick="app.filter('high', this)">ğŸ”¥ é‡é»å ±å‘Š</div>
            <div class="nav-pill" onclick="app.filter('ai', this)">ğŸ¤– AI ä¾›æ‡‰éˆ</div>
            <div class="nav-pill" onclick="app.goNews()">âš¡ å¤–é›»å¿«è¨Š</div>
            <div class="nav-pill" onclick="app.goInd()">ğŸ­ ç”¢æ¥­ç™¾ç§‘</div>
        </div>
    </div>

    <div class="masonry-grid" id="feed-container"></div>
    <div style="text-align:center; color:#999; font-size:14px; margin-top:20px; font-weight:500;">å·²ç¶“åˆ°åº•äº†</div>
</div>

<div id="detailView" class="view">
    <div style="padding: 24px 20px 0; background: #f0f2f5; position: sticky; top: 0; z-index: 10;">
        <h2 style="margin:0 0 8px 0; color:#111827; font-size: 28px; font-weight:900;">æ·±åº¦è§£æ</h2>
        <p style="margin:0; font-size:14px; color:#6b7280; font-weight:500;">19 æ¬„ä½å®Œæ•´æ­éœ²</p>
    </div>
    <div class="chat-flow-container" id="chat-content"></div>
    <div class="fab-back" onclick="app.back()">â†©</div>
</div>

<div id="newsView" class="view">
    <div class="header-container">
        <div class="header-top"><h2 style="font-size:28px; font-weight:900; margin:0;">å¤–é›»æƒ…å ±</h2></div>
    </div>
    <div class="list-container" id="news-list"></div>
    <div class="fab-back" onclick="app.back()">â†©</div>
</div>

<div id="indView" class="view">
    <div class="header-container">
        <div class="header-top"><h2 style="font-size:28px; font-weight:900; margin:0;">ç”¢æ¥­ç™¾ç§‘</h2></div>
        <div style="padding:0 20px 16px;">
            <input type="text" placeholder="è¼¸å…¥ä»£è™Ÿæˆ–åç¨±..." onkeyup="app.searchInd(this.value)"
                   style="width:100%; padding:16px; border:none; background:#f3f4f6; border-radius:14px; outline:none; font-size:18px;">
        </div>
    </div>
    <div class="list-container" id="ind-list"></div>
    <div class="fab-back" onclick="app.back()">â†©</div>
</div>

<div id="favView" class="view">
    <div class="header-container">
        <div class="header-top"><h2 style="font-size:28px; font-weight:900; margin:0;">è‡ªé¸æ¸…å–®</h2></div>
        <div style="padding:0 20px 16px; font-size:15px; color:#666;">æ‚¨é—œæ³¨çš„é«˜é‡è¦æ€§å ±å‘Š</div>
    </div>
    <div class="masonry-grid" id="fav-container"></div>
    <div class="fab-back" onclick="app.back()">â†©</div>
</div>

<div class="bottom-nav">
    <div class="bn-item active" onclick="app.switchView('homeView')"><span class="bn-icon">ğŸ </span>é¦–é </div>
    <div class="bn-item" onclick="app.goInd()"><span class="bn-icon">ğŸ­</span>ç”¢æ¥­</div>
    <div class="bn-item" onclick="app.goNews()"><span class="bn-icon">âš¡</span>å¤–é›»</div>
    <div class="bn-item" onclick="app.goFav()"><span class="bn-icon">â¤ï¸</span>è‡ªé¸</div>
</div>

<script>
// å…§å»ºæ¸¬è©¦è³‡æ–™
const TEST_REPORTS = [
    {
        id: "R001", company: "è¯ç¢©", code: "2357", date: "2025/11/19", broker: "å…ƒå¤§æŠ•é¡§", 
        rating: "è²·é€²", target: "700", imp: "é«˜", summary: "ä¼ºæœå™¨ç‡Ÿæ”¶ä½”æ¯”æ˜å¹´æŒ‘æˆ° 20%ï¼ŒGB200 å‡ºè²¨é †æš¢ã€‚",
        full: {
            analyst: "é­å»ºç™¼", type: "Call Memo", ind: "PC/ä¼ºæœå™¨",
            fin: "3Q25 ç‡Ÿæ”¶ 1,899å„„ (QoQ+9%)ï¼ŒEPS 14.2å…ƒã€‚",
            ops: "1. ä¼ºæœå™¨ï¼šé è¨ˆ 2025 å¹´å€å¢ã€‚\n2. PCï¼šAI PC å¸‚å ç‡ 25%ã€‚",
            strat: "å…¨åŠ›è½‰å‹ AI ä¼ºæœå™¨è§£æ±ºæ–¹æ¡ˆã€‚",
            qa: "Q: GB200 å‡ºè²¨ï¼Ÿ A: 12æœˆå°é‡ï¼ŒQ1æ”¾é‡ã€‚",
            rex: "è¯ç¢©æ˜¯é€™æ³¢ AI ä¼ºæœå™¨è¢«ä½ä¼°çš„æ¨™çš„ï¼Œèµ·æ­¥æ™šä½†è¿½è¶•å¿«ã€‚",
            follow: "1æœˆ CES å±•æ–°å“ã€‚"
        }
    },
    {
        id: "R002", company: "è‡´èŒ‚", code: "2360", date: "2025/11/19", broker: "å¤§æ‘©", 
        rating: "å„ªæ–¼å¤§ç›¤", target: "520", imp: "ä¸­", summary: "SLT æ¸¬è©¦è¨­å‚™éœ€æ±‚å¼·å‹ï¼Œè¨‚å–®èƒ½è¦‹åº¦é” 2026ã€‚",
        full: {
            analyst: "Sharon", type: "å€‹è‚¡", ind: "å„€å™¨",
            fin: "é ä¼° Q4 ç‡Ÿæ”¶å­£å¢ 15%ã€‚",
            ops: "AI æ™¶ç‰‡åŠŸè€—æå‡æ‹‰é•·æ¸¬è©¦æ™‚é–“ã€‚",
            strat: "æ·±è€•åŠå°é«” Final Testã€‚",
            qa: "Q: CoWoS æ“´ç”¢ï¼Ÿ A: æ­£å‘ã€‚",
            rex: "è¨­å‚™è‚¡ç‹ã€‚æ¸¬è©¦æ™‚é–“æ‹‰é•·æ˜¯æœ€å¤§åˆ©å¤šã€‚",
            follow: "CoWoS æ“´ç”¢é€²åº¦ã€‚"
        }
    }
];

const TEST_NEWS = [
    { src:"Bloomberg", date:"11/19", co:"å°ç©é›»", code:"2330", title:"è‰¯ç‡è¶…è»Š", content:"äºåˆ©æ¡‘é‚£å» è‰¯ç‡å„ªæ–¼å°ç£å» å€ã€‚" },
    { src:"WSJ", date:"11/19", co:"è¯ç™¼ç§‘", code:"2454", title:"å¤©ç’£ç†±éŠ·", content:"å—æƒ  Vivo æ–°æ©Ÿï¼Œå¸‚å ç‡æå‡ã€‚" }
];

const TEST_IND = [
    { n:"å°ç©é›»", c:"2330", i:"åŠå°é«”", p:"å…¨çƒæ™¶åœ“ä»£å·¥é¾é ­" },
    { n:"è¯ç¢©", c:"2357", i:"é›»è…¦é€±é‚Š", p:"ä¸»æ©Ÿæ¿ç¬¬ä¸€å¤§" }
];

// App é‚è¼¯
let DB_REPORTS = TEST_REPORTS;
let DB_NEWS = TEST_NEWS;
let DB_IND = TEST_IND;

const app = {
    history: ['homeView'],

    init: async function() {
        try {
            await Promise.all([
                this.loadXLSX('reports.xlsx', 'report'),
                this.loadXLSX('news.xlsx', 'news'),
                this.loadXLSX('industry.xlsx', 'ind')
            ]);
            document.getElementById('db-status').innerText = "ğŸŸ¢ ç·šä¸Šè³‡æ–™";
        } catch (e) {
            console.log("ä½¿ç”¨æ¸¬è©¦è³‡æ–™");
        }
        this.renderFeed(DB_REPORTS, 'feed-container');
        this.renderFeed(DB_REPORTS.filter(d=>d.imp==='é«˜'), 'fav-container');
        this.renderNews();
        this.searchInd('');
    },

    loadXLSX: async function(url, type) {
        const resp = await fetch(url);
        if(!resp.ok) throw new Error("File not found");
        const ab = await resp.arrayBuffer();
        const wb = XLSX.read(ab, {type:'array'});
        const json = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
        
        if(type==='report') this.processReports(json);
        if(type==='news') this.processNews(json);
        if(type==='ind') this.processInd(json);
    },

    processReports: function(data) {
        DB_REPORTS = data.map((r, i) => ({
            id: r['ç·¨è™Ÿ'] || i, company: r['å…¬å¸'], code: r['è‚¡è™Ÿ'], date: r['å ±å‘Šæ—¥æœŸ'],
            broker: r['åˆ¸å•†'], rating: r['æŠ•è³‡è©•ç­‰'], target: r['ç›®æ¨™åƒ¹'], imp: r['é‡è¦æ€§'],
            summary: r['ç²¾ç°¡é‡é»æ‘˜è¦'], tags: r['æ¨™ç±¤'],
            full: {
                analyst: r['åˆ†æå¸«'], type: r['å ±å‘Šé¡å‹'], ind: r['ç”¢æ¥­'],
                fin: r['é—œéµè²¡å‹™æ•¸æ“š'], ops: r['ç‡Ÿé‹é‡é»'], strat: r['ç­–ç•¥æ–¹å‘'],
                qa: r['é‡è¦QAæ‘˜è¦'], rex: r['Rexè§€å¯Ÿ'], follow: r['å¾ŒçºŒè¿½è¹¤']
            }
        }));
    },
    processNews: function(data) {
        DB_NEWS = data.map(r => ({
            src: r['åˆ¸å•†ä¾†æº'], date: r['æ—¥æœŸ'], co: r['å…¬å¸'], code: r['è‚¡è™Ÿ'],
            title: r['å ±å°é‡é»åˆ†é¡'], content: r['å®Œæ•´å ±å°å…§å®¹']
        }));
    },
    processInd: function(data) {
        DB_IND = data.map(r => ({ n: r['åç¨±'], c: r['ä»£è™Ÿ'], i: r['ç”¢æ¥­'], p: r['ç”¢æ¥­åœ°ä½'] }));
    },

    renderFeed: function(data, containerId) {
        const el = document.getElementById(containerId);
        if(!data || data.length === 0) { el.innerHTML = '<div style="grid-column:span 2; text-align:center; padding:20px;">ç„¡è³‡æ–™</div>'; return; }
        
        el.innerHTML = data.map((d) => `
            <div class="summary-card" onclick="app.goDetail('${d.id}')">
                <span class="sc-rating ${d.rating&&d.rating.includes('è²·')?'bg-buy':'bg-hold'}">${d.rating}</span>
                <div class="sc-head">
                    <div class="sc-comp">${d.company}</div>
                    <span class="sc-code">${d.code}</span>
                </div>
                <div class="sc-body">${d.summary}</div>
                <div class="sc-foot">
                    <span>${d.broker}</span>
                    <span style="font-weight:700; color:#111827">TP: ${d.target}</span>
                </div>
                ${d.imp==='é«˜' ? '<div style="position:absolute;top:14px;right:14px;width:10px;height:10px;border-radius:50%;background:red;"></div>':''}
            </div>
        `).join('');
    },

    goDetail: function(id) {
        const d = DB_REPORTS.find(x => x.id == id);
        if(!d) return;
        const c = document.getElementById('chat-content');
        c.innerHTML = '';
        const blocks = [
            { h: `ğŸ“Œ ${d.company} ${d.code}`, t: `${d.date} Â· ${d.broker} ${d.full.analyst}\nè©•ç­‰: ${d.rating} Â· ç›®æ¨™åƒ¹: ${d.target}`, cls:'box-meta' },
            { h: `âš¡ é‡é»æ‘˜è¦`, t: d.summary },
            { h: `ğŸ’° è²¡å‹™æ•¸æ“š`, t: d.full.fin },
            { h: `ğŸ¢ ç‡Ÿé‹é‡é»`, t: d.full.ops },
            { h: `ğŸ¯ ç­–ç•¥æ–¹å‘`, t: d.full.strat },
            { h: `â“ QA æ‘˜è¦`, t: d.full.qa, cls:'box-qa' },
            { h: `ğŸ‘‘ Rex è§€å¯Ÿ`, t: d.full.rex, cls:'box-rex' },
            { h: `ğŸ“… å¾ŒçºŒè¿½è¹¤`, t: d.full.follow }
        ];
        blocks.forEach((b, i) => {
            if(!b.t) return;
            setTimeout(() => {
                c.insertAdjacentHTML('beforeend', `<div class="chat-box ${b.cls||''}"><div class="box-label">${b.h}</div><div class="box-content">${b.t}</div></div>`);
                window.scrollTo(0, document.body.scrollHeight);
            }, i * 100);
        });
        this.switchView('detailView');
    },

    renderNews: function() {
        document.getElementById('news-list').innerHTML = DB_NEWS.map(n => `
            <div class="list-row" style="border-left:4px solid #f59e0b">
                <div>
                    <div style="font-weight:bold; color:#d97706; font-size:14px;">${n.src} Â· ${n.date}</div>
                    <div style="font-weight:800; font-size:20px; margin:6px 0;">${n.co} ${n.code}</div>
                    <div style="font-size:16px; margin-top:6px;">${n.content}</div>
                </div>
            </div>
        `).join('');
    },
    searchInd: function(v) {
        const res = v===''? DB_IND.slice(0,20) : DB_IND.filter(x=>(x.c+x.n).includes(v));
        document.getElementById('ind-list').innerHTML = res.map(d => `
            <div class="list-row" style="border-left:4px solid #059669">
                <div>
                    <div style="font-weight:800; font-size:20px;">${d.n} ${d.c}</div>
                    <div style="font-size:14px; color:#666;">${d.i}</div>
                    <div style="background:#ecfdf5; color:#047857; padding:8px; border-radius:8px; margin-top:8px; font-size:15px;">ğŸ† ${d.p}</div>
                </div>
            </div>
        `).join('');
    },

    switchView: function(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        // Update Nav
        document.querySelectorAll('.bn-item').forEach(b => b.classList.remove('active'));
        if(id==='homeView') document.querySelectorAll('.bn-item')[0].classList.add('active');
        if(id==='indView') document.querySelectorAll('.bn-item')[1].classList.add('active');
        if(id==='newsView') document.querySelectorAll('.bn-item')[2].classList.add('active');
        if(id==='favView') document.querySelectorAll('.bn-item')[3].classList.add('active');

        window.scrollTo(0,0);
    },
    back: function() { this.switchView('homeView'); },
    filter: function(type, btn) {
        if(btn) { document.querySelectorAll('.nav-pill').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); }
        let res = DB_REPORTS;
        if(type==='high') res = DB_REPORTS.filter(d => d.imp==='é«˜');
        if(type==='ai') res = DB_REPORTS.filter(d => JSON.stringify(d).includes('AI'));
        this.renderFeed(res, 'feed-container');
    },
    goNews: function() { this.switchView('newsView'); },
    goInd: function() { this.switchView('indView'); },
    goFav: function() { this.switchView('favView'); }
};

app.init();
</script>
</body>
</html>
