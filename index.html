<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Rexå¤§å”çš„168æ•™å®¤</title>
<style>
    :root {
        --bg-body: #f4f6f8;
        --card-bg: #ffffff;
        /* è²·é€²è¨Šè™Ÿè‰² (æ·¡ç²‰ç´…) */
        --bg-buy: #fff0f2; 
        --border-buy: #fecdd3;
        
        --primary: #4f46e5;
        --text-dark: #111827;
        --text-gray: #64748b;
        --radius: 12px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "PingFang TC", sans-serif;
        background: var(--bg-body);
        color: var(--text-dark);
        margin: 0;
        padding-bottom: 100px;
        line-height: 1.5;
        overscroll-behavior-y: none;
    }

    /* === è¦–åœ– === */
    .view { display: none; width: 100%; min-height: 100vh; }
    .view.active { display: block; animation: fadeIn 0.2s ease-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* === Header === */
    .header-sticky {
        position: sticky; top: 0; z-index: 100;
        background: rgba(255,255,255,0.98);
        backdrop-filter: blur(10px);
        box-shadow: 0 1px 5px rgba(0,0,0,0.03);
        padding-bottom: 8px;
    }
    .header-row {
        padding: 14px 16px 10px; 
        display: flex; justify-content: space-between; align-items: center;
    }
    .app-title { font-size: 22px; font-weight: 900; color: var(--text-dark); }
    
    .nav-scroll {
        display: flex; gap: 10px; padding: 0 16px 10px; 
        overflow-x: auto; scrollbar-width: none;
    }
    .nav-pill {
        flex-shrink: 0; padding: 6px 16px; background: #f1f5f9; border-radius: 20px;
        font-size: 14px; font-weight: 600; color: var(--text-gray); 
        cursor: pointer; transition: 0.2s;
    }
    .nav-pill.active { background: #1e293b; color: #fff; }

    /* === å¡ç‰‡ç¶²æ ¼ === */
    .grid-container {
        padding: 16px; 
        display: grid; 
        grid-template-columns: 1fr 1fr; /* å¼·åˆ¶å…©æ¬„ */
        gap: 12px;
        align-items: start;
    }
    
    .card {
        background: #fff; border-radius: var(--radius); padding: 14px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
        position: relative;
        display: flex; flex-direction: column;
        min-height: 200px; 
        border: 1px solid rgba(0,0,0,0.03);
        width: 100%;
        overflow: hidden;
    }
    
    .card.is-buy { background: var(--bg-buy); border: 1px solid var(--border-buy); }
    
    /* æ„›å¿ƒ */
    .btn-fav {
        position: absolute; top: 10px; right: 10px; z-index: 10;
        font-size: 20px; color: #cbd5e1; cursor: pointer; padding: 4px;
    }
    .btn-fav.active { color: #ef4444; }

    /* === å¡ç‰‡å…§å®¹æ’ç‰ˆ === */
    
    /* Row 1: ä»£è™Ÿ + åç¨± + ç”¢æ¥­ */
    .c-head-row {
        display: flex; align-items: baseline; gap: 4px; margin-bottom: 6px;
        padding-right: 24px;
        flex-wrap: wrap;
    }
    .c-code { font-size: 14px; font-weight: 700; color: var(--primary); }
    .c-name { font-size: 18px; font-weight: 900; color: #111827; }
    .c-ind { 
        font-size: 12px; color: #64748b; background: #f1f5f9; 
        padding: 1px 6px; border-radius: 4px; margin-left: 2px;
    }

    /* Row 2: ç”¢æ¥­åœ°ä½ */
    .c-pos-row {
        font-size: 12px; color: #b45309; font-weight: 600;
        margin-bottom: 10px; display: flex; align-items: flex-start; gap: 4px;
        line-height: 1.3;
    }
    
    /* Body: ç­–ç•¥ */
    .c-body { 
        font-size: 14px; color: #334155; line-height: 1.5;
        overflow: hidden; display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical;
        flex-grow: 1; white-space: pre-line; margin-bottom: 10px;
    }
    
    /* Footer */
    .c-foot { 
        padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.05);
        font-size: 12px; color: #64748b; display: flex; justify-content: space-between; font-weight: 700;
    }
    .val-red { color: #ef4444; }

    /* === è©³æƒ…é  === */
    .chat-container { padding: 20px; max-width: 800px; margin: 0 auto; display: flex; flex-direction: column; gap: 16px; }
    .bubble {
        background: #fff; border-radius: 16px; padding: 20px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .b-meta { border-left: 5px solid var(--primary); }
    .b-rex { background: #fffbeb; border: 2px solid #fcd34d; }
    .b-label { 
        font-size: 13px; font-weight: 800; color: #9ca3af; margin-bottom: 8px; 
        letter-spacing: 1px; text-transform: uppercase; 
    }
    .b-text { font-size: 17px; line-height: 1.7; color: #1e293b; white-space: pre-line; }

    /* === æœå°‹ & åˆ—è¡¨ === */
    .search-wrap { padding: 0 16px 12px; background: rgba(255,255,255,0.98); }
    .search-input { width: 100%; padding: 12px 16px; border: none; background: #f1f5f9; border-radius: 12px; font-size: 16px; outline: none; }
    .news-list { padding: 16px; display: flex; flex-direction: column; gap: 12px; }
    .news-card { background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); border-left: 4px solid #f59e0b; }
    .n-src { font-weight: 800; color: #d97706; font-size: 13px; margin-bottom: 4px; display: flex; justify-content: space-between; }
    .n-title { font-size: 17px; font-weight: 800; margin-bottom: 6px; }
    .n-txt { font-size: 15px; color: #334155; line-height: 1.6; white-space: pre-line; }

    /* === åº•éƒ¨å°èˆª === */
    .bottom-nav {
        position: fixed; bottom: 0; left: 0; right: 0; z-index: 900;
        background: rgba(255,255,255,0.98); border-top: 1px solid #e2e8f0;
        display: flex; justify-content: space-around; 
        padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
    }
    .nav-btn { flex: 1; text-align: center; color: #94a3b8; font-size: 10px; font-weight: 600; cursor: pointer; }
    .nav-btn.active { color: var(--primary); }
    .nav-icon { font-size: 24px; display: block; margin-bottom: 2px; }
    
    .fab-back {
        position: fixed; bottom: 100px; right: 20px; z-index: 999;
        width: 50px; height: 50px; background: #1e293b; color: white;
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-size: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;
    }
</style>
</head>
<body>

<div id="homeView" class="view active">
    <div class="header-sticky">
        <div class="header-row">
            <div class="app-title">Rexå¤§å”çš„168æ•™å®¤</div>
            <div id="db-status" style="font-size:12px; color:#059669;">ğŸŸ¢ å…§å»ºè³‡æ–™å·²è¼‰å…¥</div>
        </div>
        <div class="nav-scroll">
            <div class="nav-pill active" onclick="app.filter('all', this)">å…¨éƒ¨</div>
            <div class="nav-pill" onclick="app.filter('high', this)">ğŸ”¥ é‡é»</div>
            <div class="nav-pill" onclick="app.filter('ai', this)">ğŸ¤– AI</div>
            <div class="nav-pill" onclick="app.filter('semi', this)">ğŸ­ åŠå°é«”</div>
        </div>
    </div>
    <div class="grid-container" id="feed-container"></div>
</div>

<div id="favView" class="view">
    <div class="header-sticky">
        <div class="header-row"><div class="app-title">â¤ï¸ è‡ªé¸æ¸…å–®</div></div>
    </div>
    <div class="grid-container" id="fav-container"></div>
    <div id="fav-empty" style="text-align:center; padding:60px 20px; color:#94a3b8; font-size:15px; display:none;">
        <div style="font-size:36px; margin-bottom:10px;">ğŸ“­</div>é»æ“Šå¡ç‰‡æ„›å¿ƒåŠ å…¥æ”¶è—
    </div>
</div>

<div id="newsView" class="view">
    <div class="header-sticky">
        <div class="header-row"><div class="app-title">âš¡ å¤–é›»å¿«è¨Š</div></div>
        <div class="search-wrap">
            <input type="text" class="search-input" placeholder="æœå°‹å¤–é›»..." onkeyup="app.searchNews(this.value)">
        </div>
    </div>
    <div class="news-list" id="news-container"></div>
</div>

<div id="indView" class="view">
    <div class="header-sticky">
        <div class="header-row"><div class="app-title">ğŸ­ ç”¢æ¥­ç™¾ç§‘</div></div>
        <div class="search-wrap">
            <input type="text" class="search-input" placeholder="æœå°‹ä»£è™Ÿ..." onkeyup="app.searchInd(this.value)">
        </div>
    </div>
    <div class="news-list" id="ind-container"></div>
</div>

<div id="detailView" class="view" style="background:#fff; z-index:200;">
    <div style="padding:16px 20px; border-bottom:1px solid #f1f5f9; position:sticky; top:0; background:#fff;">
        <div style="font-size:22px; font-weight:800;">æ·±åº¦è§£æ</div>
    </div>
    <div class="chat-container" id="detail-content"></div>
    <div class="fab-back" onclick="app.back()">â†©</div>
</div>

<div class="bottom-nav">
    <div class="nav-btn active" onclick="app.switchView('homeView', this)"><span class="nav-icon">ğŸ </span>é¦–é </div>
    <div class="nav-btn" onclick="app.switchView('favView', this); app.renderFav();"><span class="nav-icon">â¤ï¸</span>è‡ªé¸</div>
    <div class="nav-btn" onclick="app.switchView('newsView', this)"><span class="nav-icon">âš¡</span>å¤–é›»</div>
    <div class="nav-btn" onclick="app.switchView('indView', this)"><span class="nav-icon">ğŸ­</span>ç”¢æ¥­</div>
</div>

<script>
// === å…§å»ºè³‡æ–™åº« (ä¿®å¾©é€£çµå•é¡Œ) ===

// 1. å ±å‘Šè³‡æ–™
const DATA_REPORTS = [
    {
        id: "R01", company: "å°ç©é›»", code: "2330", date: "2025/11/20", broker: "é«˜ç››", 
        rating: "è²·é€²", target: "1380", imp: "é«˜", tags: "AI,åŠå°é«”",
        summary: "CoWoS ç”¢èƒ½å€å¢ï¼Œ2026 å¹´è¨‚å–®èƒ½è¦‹åº¦é«˜ã€‚",
        full: { 
            strat: "1. 3nm è£½ç¨‹åˆ©ç”¨ç‡æ»¿è¼‰ã€‚\n2. AI æ™¶ç‰‡éœ€æ±‚å¼·å‹ï¼Œä¸»è¦å®¢æˆ¶è¿½å–®ã€‚\n3. 2026 å¹´è³‡æœ¬æ”¯å‡ºç¶­æŒé«˜æª”ã€‚", 
            fin: "ç‡Ÿæ”¶å­£å¢ 15%ï¼Œæ¯›åˆ©ç‡ç¶­æŒ 55% ä»¥ä¸Šã€‚", 
            rex: "è­·åœ‹ç¥å±±åœ°ä½ç©©å›ºï¼Œå›æª”å³æ˜¯è²·é»ã€‚", 
            qa: "Q: ç«¶çˆ­å°æ‰‹ç‹€æ³? A: ç›®å‰æŠ€è¡“é ˜å…ˆè‡³å°‘ 2 å¹´ã€‚"
        }
    },
    {
        id: "R02", company: "è¯ç¢©", code: "2357", date: "2025/11/19", broker: "å…ƒå¤§æŠ•é¡§", 
        rating: "è²·é€²", target: "700", imp: "é«˜", tags: "AI PC,ä¼ºæœå™¨",
        summary: "ä¼ºæœå™¨ç‡Ÿæ”¶ä½”æ¯”æ˜å¹´æŒ‘æˆ° 20%ï¼ŒAI PC æ›æ©Ÿæ½®å•Ÿå‹•ã€‚",
        full: { 
            strat: "1. ä¼ºæœå™¨ï¼šé è¨ˆ 2025 å¹´å€å¢ï¼Œä¸»è¦å—æƒ  Tier 2 è³‡æ–™ä¸­å¿ƒéœ€æ±‚ã€‚\n2. PCï¼šAI PC å¸‚å ç‡ç›®æ¨™ 25%ï¼Œæ–°æ©Ÿå‹å¹³å‡å–®åƒ¹æå‡ã€‚", 
            fin: "å–®å­£ EPS å‰µæ–°é«˜ï¼Œç‡Ÿé‹æ§“æ¡¿æ•ˆç›Šæµ®ç¾ã€‚", 
            rex: "æœ¬ç›Šæ¯”ä»ä½ï¼Œå…·å‚™ AI ä¼ºæœå™¨è½‰æ©Ÿé¡Œæã€‚", 
            qa: "Q: ä¾›æ‡‰éˆç‹€æ³? A: é—œéµé›¶çµ„ä»¶å‚™è²¨é †æš¢ã€‚"
        }
    },
    {
        id: "R03", company: "è‡´èŒ‚", code: "2360", date: "2025/11/18", broker: "æ‘©æ ¹å£«ä¸¹åˆ©", 
        rating: "ä¸­ç«‹", target: "520", imp: "ä¸­", tags: "åŠå°é«”è¨­å‚™",
        summary: "SLT æ¸¬è©¦è¨­å‚™éœ€æ±‚å¼·å‹ï¼Œç­‰å¾… CoWoS æ–°ç”¢èƒ½æ•ˆæ‡‰ã€‚",
        full: { 
            strat: "1. åŠå°é«”æ¸¬è©¦éœ€æ±‚éš¨å…ˆé€²å°è£æˆé•·ã€‚\n2. çŸ½å…‰å­æª¢æ¸¬è¨­å‚™é–‹å§‹é€æ¨£ã€‚", 
            fin: "ç‡Ÿæ”¶æŒå¹³ï¼Œç­‰å¾…æ˜å¹´çˆ†ç™¼ã€‚", 
            rex: "è‚¡åƒ¹çŸ­ç·šæ¼²å¤šï¼Œå»ºè­°æ‹‰å›å†è§€å¯Ÿã€‚", 
            qa: "Q: æ“´ç”¢é€²åº¦? A: æŒ‰è¨ˆç•«é€²è¡Œä¸­ã€‚"
        }
    },
    {
        id: "R04", company: "é´»æµ·", code: "2317", date: "2025/11/17", broker: "é‡æ‘", 
        rating: "è²·é€²", target: "250", imp: "é«˜", tags: "AIä¼ºæœå™¨,GB200",
        summary: "GB200 ä¼ºæœå™¨å‡ºè²¨åœ¨å³ï¼Œå‚ç›´æ•´åˆå„ªå‹¢æ˜é¡¯ã€‚",
        full: {
            strat: "1. æŒæ¡ GB200 é—œéµä¾›æ‡‰éˆä»½é¡ã€‚\n2. æ•£ç†±æ¨¡çµ„è‡ªè£½ç‡æå‡ï¼Œæ”¹å–„æ¯›åˆ©ç‡ã€‚",
            fin: "å‰ä¸‰å­£ç²åˆ©å„ªæ–¼é æœŸã€‚",
            rex: "AI ä¼ºæœå™¨æœ€å¤§å—æƒ è€…ä¹‹ä¸€ï¼Œé•·ç·šçœ‹å¥½ã€‚"
        }
    },
    {
        id: "R05", company: "ç·¯ç©", code: "6669", date: "2025/11/16", broker: "å‡±åŸº", 
        rating: "ä¸­ç«‹", target: "2300", imp: "ä¸­", tags: "AIä¼ºæœå™¨",
        summary: "ASIC ä¼ºæœå™¨éœ€æ±‚æ”¾ç·©ï¼Œé—œæ³¨ GPU å°ˆæ¡ˆé€²åº¦ã€‚",
        full: {
            strat: "1. é AI å°ˆæ¡ˆä½”æ¯”ä»é«˜ã€‚\n2. æ–°å®¢æˆ¶é–‹ç™¼éœ€æ™‚é–“ç™¼é…µã€‚",
            rex: "è©•åƒ¹åˆç†ï¼Œç­‰å¾…æ–°å°ˆæ¡ˆè²¢ç»ç‡Ÿæ”¶ã€‚"
        }
    }
];

// 2. ç”¢æ¥­è³‡æ–™
const DATA_IND = [
    { n:"å°ç©é›»", c:"2330", m:"ä¸Šå¸‚", i:"åŠå°é«”", p:"å…¨çƒæ™¶åœ“ä»£å·¥é¾é ­ (å¸‚å >60%)" },
    { n:"è¯ç¢©", c:"2357", m:"ä¸Šå¸‚", i:"é›»è…¦é€±é‚Š", p:"å…¨çƒä¸»æ©Ÿæ¿ç¬¬ä¸€å¤§ã€é›»ç«¶ç­†é›»é¾é ­" },
    { n:"è‡´èŒ‚", c:"2360", m:"ä¸Šå¸‚", i:"å„€å™¨è¨­å‚™", p:"å…¨çƒé›»åŠ›é›»å­æ¸¬é©—è¨­å‚™é¾é ­" },
    { n:"é´»æµ·", c:"2317", m:"ä¸Šå¸‚", i:"é›»å­ä»£å·¥", p:"å…¨çƒæœ€å¤§é›»å­ä»£å·¥å»  (EMS)" },
    { n:"ç·¯ç©", c:"6669", m:"ä¸Šå¸‚", i:"é›²ç«¯é‹ç®—", p:"ç™½ç‰Œä¼ºæœå™¨å¤§å»  (ODM Direct)" },
    { n:"è¯ç™¼ç§‘", c:"2454", m:"ä¸Šå¸‚", i:"ICè¨­è¨ˆ", p:"æ‰‹æ©Ÿæ™¶ç‰‡å‡ºè²¨é‡å…¨çƒç¬¬ä¸€" },
    { n:"å»£é”", c:"2382", m:"ä¸Šå¸‚", i:"é›»è…¦é€±é‚Š", p:"ç­†é›»ä»£å·¥é¾é ­ã€AIä¼ºæœå™¨å…ˆé©…" }
];

// 3. å¤–é›»è³‡æ–™
const DATA_NEWS = [
    { src: "Bloomberg", date: "2025/11/20", co: "Nvidia", code: "NVDA", title: "Blackwell æ™¶ç‰‡éœ€æ±‚è¶…ä¹é æœŸ", content: "Nvidia åŸ·è¡Œé•·é»ƒä»å‹³è¡¨ç¤ºï¼ŒBlackwell æ™¶ç‰‡éœ€æ±‚'ç˜‹ç‹‚'ï¼Œä¾›æ‡‰éˆæ­£å…¨åŠ›è¶•å·¥ã€‚å¾®è»Ÿã€Meta ç­‰å¤§å®¢æˆ¶æŒçºŒè¿½åŠ è¨‚å–®ã€‚" },
    { src: "Reuters", date: "2025/11/19", co: "TSMC", code: "2330", title: "äºåˆ©æ¡‘é‚£å» è‰¯ç‡è¿½ä¸Šå°ç£", content: "å°ç©é›»ç¾åœ‹å» åˆæœŸè©¦ç”¢è‰¯ç‡è¡¨ç¾å„ªç•°ï¼Œç”šè‡³ç•¥é«˜æ–¼å°ç£åŒæœŸæ°´æº–ï¼Œæ¶ˆé™¤å¸‚å ´ç–‘æ…®ã€‚" },
    { src: "Digitimes", date: "2025/11/18", co: "Server", code: "-", title: "AI ä¼ºæœå™¨æ˜å¹´å‡ºè²¨ä¼°å¢ 50%", content: "ä¾›æ‡‰éˆæŒ‡å‡ºï¼Œ2025 å¹´ AI ä¼ºæœå™¨å‡ºè²¨é‡å°‡æŒçºŒçˆ†ç™¼ï¼Œå…¶ä¸­æ¶²å†·æ•£ç†±æ»²é€ç‡å°‡å¤§å¹…æå‡è‡³ 30%ã€‚" }
];

let FAVORITES = JSON.parse(localStorage.getItem('rex_fav_ids_v6')) || [];
let DB_REPORTS = [];
let DB_NEWS = [];
let DB_IND = [];

const app = {
    init: function() {
        // ç›´æ¥è¼‰å…¥å…§å»ºè³‡æ–™ï¼Œä¸å†å˜—è©¦ fetch å¤–éƒ¨æª”æ¡ˆ
        DB_REPORTS = DATA_REPORTS;
        DB_IND = DATA_IND;
        DB_NEWS = DATA_NEWS;
        
        this.renderFeed(DB_REPORTS);
        this.searchInd('');
        this.renderNews(DB_NEWS); // é å…ˆè¼‰å…¥å¤–é›»
    },

    // --- 1. å¡ç‰‡æ¸²æŸ“ ---
    renderFeed: function(data, containerId = 'feed-container') {
        const el = document.getElementById(containerId);
        if(!data || data.length === 0) {
            el.innerHTML = "";
            if(containerId==='fav-container') document.getElementById('fav-empty').style.display = 'block';
            return;
        }
        if(containerId==='fav-container') document.getElementById('fav-empty').style.display = 'none';

        el.innerHTML = data.map(d => {
            const isFav = FAVORITES.includes(d.id);
            const isBuy = d.rating && (d.rating.includes('è²·') || d.rating.includes('å„ª'));
            
            // æ•´åˆç”¢æ¥­è³‡è¨Š
            const ind = DB_IND.find(i => i.c == d.code) || {};
            const indText = ind.i ? `${ind.m||''} ${ind.i}` : '';
            
            // ç­–ç•¥æ–‡å­—è™•ç†
            let stratText = "";
            if(d.full && d.full.strat) stratText = d.full.strat;
            else if(d.summary) stratText = d.summary;
            
            // å–å‰ä¸‰è¡Œ
            if(stratText) {
                const lines = stratText.split(/[\n\r]+/);
                if(lines.length > 3) stratText = lines.slice(0,3).join('\n') + '...';
            }

            return `
            <div class="card ${isBuy ? 'is-buy' : ''}" onclick="app.goDetail('${d.id}')">
                <div class="btn-fav ${isFav?'active':''}" onclick="event.stopPropagation(); app.toggleFav('${d.id}', this)">
                    ${isFav ? 'â™¥' : 'â™¡'}
                </div>
                
                <div class="c-head-row">
                    <span class="c-code">${d.code}</span>
                    <span class="c-name">${d.company}</span>
                    <span class="c-ind">${indText}</span>
                </div>
                
                ${ind.p ? `<div class="c-pos-row">ğŸ† ${ind.p}</div>` : ''}
                
                <div class="c-body">${stratText}</div>
                
                <div class="c-foot">
                    <span class="${isBuy?'val-red':''}">${d.rating}</span>
                    <span>TP: ${d.target}</span>
                </div>
            </div>`;
        }).join('');
    },

    // 2. è‡ªé¸åŠŸèƒ½
    toggleFav: function(id, btn) {
        if(FAVORITES.includes(id)) {
            FAVORITES = FAVORITES.filter(fid => fid !== id);
            btn.innerText = 'â™¡'; btn.classList.remove('active');
        } else {
            FAVORITES.push(id);
            btn.innerText = 'â™¥'; btn.classList.add('active');
        }
        localStorage.setItem('rex_fav_ids_v6', JSON.stringify(FAVORITES));
        
        if(document.getElementById('favView').style.display === 'block') {
            this.renderFav();
        }
    },
    renderFav: function() {
        if(DB_REPORTS.length === 0) return;
        const favData = DB_REPORTS.filter(d => FAVORITES.includes(d.id));
        this.renderFeed(favData, 'fav-container');
    },

    // 3. è©³æƒ…é 
    goDetail: function(id) {
        const d = DB_REPORTS.find(r => r.id === id);
        if(!d) return; 
        const c = document.getElementById('detail-content');
        
        const getVal = (v) => (v && v !== 'undefined') ? v : '';
        const block = (label, txt, cls='') => {
            if(!txt || txt.length < 2) return '';
            return `<div class="bubble ${cls}"><div class="b-label">${label}</div><div class="b-text">${txt}</div></div>`;
        };

        c.innerHTML = `
            <div class="bubble b-meta">
                <div class="b-label">ğŸ“Œ å ±å‘Šè³‡è¨Š</div>
                <div class="b-text" style="font-weight:700">${d.broker} Â· ${d.date}</div>
                <div style="margin-top:10px; font-weight:700; color:${d.rating.includes('è²·')?'#ef4444':'#111827'}">
                    ${d.rating} Â· ç›®æ¨™åƒ¹ ${d.target}
                </div>
            </div>
            ${block('âš¡ æ‘˜è¦', d.summary)}
            ${block('ğŸ¯ ç­–ç•¥', getVal(d.full.strat))}
            ${block('ğŸ’° è²¡å‹™', getVal(d.full.fin))}
            ${block('ğŸ¢ ç‡Ÿé‹', getVal(d.full.ops))}
            ${block('â“ QA', getVal(d.full.qa))}
            ${block('ğŸ‘‘ Rex è§€å¯Ÿ', getVal(d.full.rex), 'b-rex')}
            ${block('ğŸ“… è¿½è¹¤', getVal(d.full.follow))}
        `;
        this.switchView('detailView');
    },

    // 4. å¤–é›»èˆ‡ç”¢æ¥­
    searchNews: function(v) {
        const res = DB_NEWS.filter(n => (n.co+n.code+n.content).toLowerCase().includes(v.toLowerCase()));
        this.renderNews(res);
    },
    renderNews: function(data) {
        const el = document.getElementById('news-container');
        el.innerHTML = data.map(n => `
            <div class="news-card">
                <div class="n-src"><span>${n.src}</span><span>${n.date}</span></div>
                <div class="n-title">${n.co} ${n.code}</div>
                <div class="n-txt">${n.content}</div>
            </div>
        `).join('');
    },
    searchInd: function(v) {
        const el = document.getElementById('ind-container');
        const res = v===''? DB_IND.slice(0,20) : DB_IND.filter(x=>(x.c+x.n).includes(v));
        el.innerHTML = res.map(d => `
            <div class="news-card" style="border-left-color:#10b981">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                    <div style="font-size:20px; font-weight:800; color:#059669">${d.n} ${d.c}</div>
                    <div style="font-size:13px; color:#666">${d.m} ${d.i}</div>
                </div>
                <div style="font-size:16px;">ğŸ† ${d.p}</div>
            </div>
        `).join('');
    },

    // é€šç”¨
    switchView: function(id, btn) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
        if(btn) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
    },
    back: function() { this.switchView('homeView'); },
    filter: function(type, btn) {
        document.querySelectorAll('.nav-pill').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        let res = DB_REPORTS;
        if(type==='high') res = res.filter(d=>d.imp==='é«˜');
        if(type==='ai') res = res.filter(d=>(d.tags+d.summary).includes('AI'));
        if(type==='semi') res = res.filter(d=>(d.tags+d.summary).includes('åŠå°é«”'));
        this.renderFeed(res);
    }
};

app.init();
</script>
</body>
</html>
