<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rex Alpha 雲端投資戰情室</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #0b1120; color: #e2e8f0; }
        .glass-panel { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); }
        .scroller::-webkit-scrollbar { width: 6px; }
        .scroller::-webkit-scrollbar-track { background: #0f172a; }
        .scroller::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .scroller::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        /* 動畫效果 */
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-pulse { animation: pulse-glow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // 設定檔案路徑 (配合 GitHub Pages 相對路徑)
        const FILES = {
            REPORTS: './reports.xlsx',
            INDUSTRY: './industry.xlsx',
            NEWS: './news.xlsx'
        };

        // SVG 圖標組件
        const Icon = ({ name, size = 16, className }) => {
            const icons = {
                search: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
                fileText: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
                trendingUp: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
                star: <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-yellow-400"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
                refresh: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>,
                github: <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.05-.015-2.07-3.345.735-4.05-1.605-4.05-1.605-.54-1.38-1.335-1.755-1.335-1.755-1.095-.75.09-.735.09-.735 1.215.09 1.845 1.245 1.845 1.245 1.08 1.845 2.82 1.32 3.525 1.005.105-.78.42-1.32.765-1.62-2.67-.3-5.475-1.335-5.475-5.94 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.225 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405 1.02 0 2.04.135 3 .405 2.295-1.56 3.3-1.23 3.3-1.23.66 1.695.24 2.925.12 3.225.765.84 1.23 1.905 1.23 3.225 0 4.62-2.805 5.625-5.49 5.925.435.375.825 1.11.825 2.235 0 1.605-.015 2.91-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>
            };
            return <span className={`inline-flex items-center ${className}`}>{icons[name]}</span>;
        };

        // 星級顯示
        const StarRating = ({ rating }) => {
            if (!rating) return null;
            const stars = typeof rating === 'string' && rating.includes('⭐') ? rating.match(/⭐/g).length : 0;
            return <div className="flex text-yellow-400">{[...Array(stars)].map((_, i) => <Icon key={i} name="star" size={14} />)}</div>;
        };

        // 標籤顯示
        const TagList = ({ tags }) => {
            if (!tags) return null;
            const tagArray = tags.toString().split(' ').filter(t => t.startsWith('#'));
            return (
                <div className="flex flex-wrap gap-2 mt-2">
                    {tagArray.map((tag, i) => (
                        <span key={i} className="px-2 py-1 text-xs bg-cyan-900/30 text-cyan-300 rounded border border-cyan-700/50 hover:bg-cyan-800/50 transition-colors cursor-default">
                            {tag}
                        </span>
                    ))}
                </div>
            );
        };

        // 詳細資料彈窗
        const StockDetailView = ({ stockCode, industryData, reportsData, newsData, onClose }) => {
            const industryInfo = industryData.find(i => String(i['代號']) === String(stockCode)) || {};
            const stockReports = reportsData.filter(r => String(r['股號']) === String(stockCode));
            const stockNews = newsData.filter(n => String(n['股號']) === String(stockCode));
            const latestReport = stockReports.length > 0 ? stockReports[0] : null;

            return (
                <div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-hidden" onClick={onClose}>
                    <div className="bg-[#131c2e] w-full max-w-7xl max-h-[95vh] rounded-2xl border border-slate-700 shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200" onClick={e => e.stopPropagation()}>
                        
                        {/* 標頭 */}
                        <div className="p-6 border-b border-slate-700 bg-gradient-to-r from-[#0f172a] to-[#1e293b] flex justify-between items-center">
                            <div className="flex items-center gap-4">
                                <div className="bg-blue-600 text-white font-black text-2xl px-4 py-2 rounded-lg shadow-lg shadow-blue-500/20 tracking-wider">
                                    {stockCode}
                                </div>
                                <div>
                                    <div className="flex items-center gap-3">
                                        <h2 className="text-2xl font-bold text-white tracking-wide">{industryInfo['名稱'] || latestReport?.['公司'] || '詳細資料'}</h2>
                                        {industryInfo['產業'] && <span className="px-3 py-0.5 bg-slate-700/50 border border-slate-600 text-slate-300 text-sm rounded-full">{industryInfo['產業']}</span>}
                                    </div>
                                    <div className="text-blue-400 font-medium mt-1 flex items-center gap-2 text-sm">
                                        {industryInfo['產業地位'] || '資料庫中無產業地位描述'}
                                    </div>
                                </div>
                            </div>
                            <button onClick={onClose} className="text-slate-400 hover:text-white hover:bg-slate-700/50 p-2 rounded-full transition-all">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                            </button>
                        </div>

                        {/* 內容區塊 */}
                        <div className="flex-1 overflow-y-auto scroller p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 bg-[#0b1120]">
                            
                            {/* 左側：深度分析 (5欄) */}
                            <div className="lg:col-span-5 space-y-6">
                                <div className="flex items-center gap-2 text-blue-400 mb-2">
                                    <Icon name="fileText" size={20} />
                                    <h3 className="text-lg font-bold uppercase tracking-wider">深度研究分析</h3>
                                </div>

                                {latestReport ? (
                                    <div className="space-y-6">
                                        {/* 核心數據卡 */}
                                        <div className="bg-slate-800/40 p-5 rounded-xl border border-slate-700/50 backdrop-blur relative overflow-hidden">
                                            <div className="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl -mr-10 -mt-10"></div>
                                            <div className="flex justify-between items-center mb-4 relative z-10">
                                                <span className="text-slate-400 text-xs bg-slate-800 px-2 py-1 rounded border border-slate-700">{latestReport['報告日期']} | {latestReport['券商']}</span>
                                                <StarRating rating={latestReport['重要性']} />
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-4 mb-4 relative z-10">
                                                <div className="bg-[#0f172a] p-3 rounded border border-slate-700">
                                                    <div className="text-slate-500 text-xs uppercase mb-1">Rating</div>
                                                    <div className={`text-xl font-black ${latestReport['投資評等']?.includes('Buy') || latestReport['投資評等']?.includes('買') ? 'text-red-400' : 'text-yellow-400'}`}>
                                                        {latestReport['投資評等']}
                                                    </div>
                                                </div>
                                                <div className="bg-[#0f172a] p-3 rounded border border-slate-700">
                                                    <div className="text-slate-500 text-xs uppercase mb-1">Target Price</div>
                                                    <div className="text-xl font-black text-emerald-400">{latestReport['目標價']}</div>
                                                </div>
                                            </div>

                                            {latestReport['Rex觀察'] && (
                                                <div className="bg-indigo-950/30 p-4 rounded border border-indigo-500/30 relative z-10">
                                                    <h4 className="text-indigo-400 font-bold text-sm mb-2 flex items-center gap-2">
                                                        <Icon name="search" size={14} /> Rex 觀點
                                                    </h4>
                                                    <p className="text-indigo-100 text-sm leading-relaxed whitespace-pre-line font-medium">{latestReport['Rex觀察']}</p>
                                                </div>
                                            )}
                                        </div>

                                        {/* 詳細文字 */}
                                        <div className="space-y-4">
                                            {[
                                                { t: "精簡重點摘要", c: latestReport['精簡重點摘要'], color: "text-slate-200" },
                                                { t: "關鍵財務數據", c: latestReport['關鍵財務數據'], color: "text-yellow-100 font-mono text-sm" },
                                                { t: "營運重點", c: latestReport['營運重點'], color: "text-slate-300" },
                                                { t: "策略方向", c: latestReport['策略方向'], color: "text-slate-300" },
                                                { t: "QA 摘要", c: latestReport['重要QA摘要'], color: "text-slate-400 italic" }
                                            ].map((item, idx) => (
                                                item.c && (
                                                    <div key={idx} className="glass-panel p-4 rounded-xl border-l-2 border-blue-500/50">
                                                        <h4 className="text-blue-400/80 text-xs font-bold mb-2 uppercase tracking-widest">{item.t}</h4>
                                                        <p className={`${item.color} text-sm leading-relaxed whitespace-pre-line`}>{item.c}</p>
                                                    </div>
                                                )
                                            ))}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="glass-panel p-8 text-center rounded-xl border-dashed border-2 border-slate-700">
                                        <p className="text-slate-500">此公司尚無深度報告紀錄</p>
                                    </div>
                                )}
                            </div>

                            {/* 中間：外電新聞 (4欄) */}
                            <div className="lg:col-span-4 space-y-4">
                                <div className="flex items-center gap-2 text-purple-400 mb-2">
                                    <Icon name="trendingUp" size={20} />
                                    <h3 className="text-lg font-bold uppercase tracking-wider">外電與動態追蹤</h3>
                                </div>
                                
                                <div className="space-y-3 max-h-[800px] overflow-y-auto scroller pr-2">
                                    {stockNews.length > 0 ? stockNews.map((news, idx) => (
                                        <div key={idx} className="glass-panel p-4 rounded-xl hover:bg-slate-800/80 transition-all group">
                                            <div className="flex justify-between items-start mb-3">
                                                <span className="text-[10px] font-bold text-purple-300 bg-purple-900/30 border border-purple-500/30 px-2 py-0.5 rounded uppercase tracking-wide">{news['券商來源']}</span>
                                                <span className="text-[10px] text-slate-500">{news['日期']}</span>
                                            </div>
                                            <h5 className="font-bold text-slate-200 mb-2 group-hover:text-white transition-colors">{news['報導重點分類']}</h5>
                                            <p className="text-slate-400 text-sm mb-3 leading-relaxed">{news['完整報導內容']}</p>
                                            <div className="flex justify-between items-center mt-2 pt-2 border-t border-slate-700/30">
                                                <TagList tags={news['標籤']} />
                                                <StarRating rating={news['重要性']} />
                                            </div>
                                        </div>
                                    )) : (
                                        <div className="text-slate-500 text-center py-10 bg-slate-800/20 rounded-xl">尚無外電追蹤</div>
                                    )}
                                </div>
                            </div>

                            {/* 右側：歷史紀錄 (3欄) */}
                            <div className="lg:col-span-3 space-y-4">
                                <div className="flex items-center gap-2 text-emerald-400 mb-2">
                                    <h3 className="text-lg font-bold uppercase tracking-wider">歷史報告</h3>
                                </div>
                                <div className="space-y-2">
                                    {stockReports.map((report, idx) => (
                                        <div key={idx} className="bg-slate-800/60 p-3 rounded-lg border border-slate-700 hover:border-emerald-500/50 transition-colors cursor-pointer group">
                                            <div className="flex justify-between mb-1">
                                                <span className="text-xs text-emerald-400/80 font-mono">{report['報告日期']}</span>
                                                <span className="text-xs text-slate-500">{report['券商']}</span>
                                            </div>
                                            <div className="font-bold text-sm text-slate-300 group-hover:text-white">{report['分析師'] || 'N/A'}</div>
                                            <div className="flex items-center justify-between text-xs mt-2">
                                                <span className="text-slate-400">TP: <span className="text-slate-200">{report['目標價']}</span></span>
                                                <span className="px-2 py-0.5 bg-slate-700 rounded text-slate-300">{report['投資評等']}</span>
                                            </div>
                                        </div>
                                    ))}
                                    {stockReports.length === 0 && <div className="text-slate-500 text-center text-sm">無歷史資料</div>}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        // 主應用程式
        const App = () => {
            const [data, setData] = useState({ reports: [], industry: [], news: [] });
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedStock, setSelectedStock] = useState(null);

            // 核心：從 GitHub (相對路徑) 讀取 Excel
            const fetchExcel = async (url) => {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`無法讀取 ${url}`);
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                return XLSX.utils.sheet_to_json(worksheet);
            };

            const loadAllData = async () => {
                setLoading(true);
                setError(null);
                try {
                    // 同時抓取三個檔案
                    const [reports, industry, news] = await Promise.all([
                        fetchExcel(FILES.REPORTS),
                        fetchExcel(FILES.INDUSTRY),
                        fetchExcel(FILES.NEWS)
                    ]);
                    setData({ reports, industry, news });
                } catch (err) {
                    console.error(err);
                    setError("無法讀取資料庫檔案。請確認 reports.xlsx, industry.xlsx, news.xlsx 是否已上傳至 GitHub 且位於同一目錄。");
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                loadAllData();
            }, []);

            // 智能關聯：整合所有股號
            const uniqueStocks = useMemo(() => {
                const stocks = new Set();
                data.reports.forEach(r => r['股號'] && stocks.add(String(r['股號'])));
                data.industry.forEach(i => i['代號'] && stocks.add(String(i['代號'])));
                data.news.forEach(n => n['股號'] && stocks.add(String(n['股號'])));
                return Array.from(stocks);
            }, [data]);

            // 搜尋過濾邏輯
            const filteredStocks = uniqueStocks.filter(code => {
                if (!searchTerm) return true;
                const searchUpper = searchTerm.toUpperCase();
                const ind = data.industry.find(i => String(i['代號']) === code);
                const rep = data.reports.find(r => String(r['股號']) === code);
                const name = ind?.['名稱'] || rep?.['公司'] || '';
                return code.includes(searchUpper) || name.includes(searchUpper);
            }).slice(0, 60); // 效能優化：限制顯示數量

            return (
                <div className="min-h-screen pb-20 bg-[#0b1120] bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-[#0b1120] to-[#0b1120]">
                    
                    {/* 導航列 */}
                    <header className="sticky top-0 z-40 backdrop-blur-md bg-[#0b1120]/80 border-b border-slate-800 shadow-2xl">
                        <div className="max-w-7xl mx-auto px-6 py-4">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex items-center gap-3">
                                    <div className="bg-blue-600 p-2 rounded-lg">
                                        <Icon name="trendingUp" className="text-white" size={24} />
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-cyan-400 to-emerald-400 tracking-tight">
                                            REX ALPHA 戰情室
                                        </h1>
                                        <p className="text-slate-500 text-xs font-mono tracking-widest uppercase">GitHub Cloud Intelligence System</p>
                                    </div>
                                </div>

                                <div className="flex items-center gap-4 w-full md:w-auto">
                                    <div className="relative w-full md:w-96 group">
                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <Icon name="search" className="text-slate-500 group-focus-within:text-blue-400 transition-colors" />
                                        </div>
                                        <input 
                                            type="text" 
                                            placeholder="輸入代號或公司名稱 (例如: 2330)" 
                                            className="block w-full pl-10 pr-3 py-2.5 bg-slate-900/50 border border-slate-700 rounded-lg leading-5 text-slate-300 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all shadow-inner"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                    </div>
                                    <button onClick={loadAllData} className="p-2.5 bg-slate-800 hover:bg-blue-600 text-slate-400 hover:text-white rounded-lg transition-all border border-slate-700" title="重新讀取 GitHub 資料">
                                        <Icon name="refresh" />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-6">
                        
                        {/* 狀態顯示 */}
                        {loading && (
                            <div className="text-center py-20 loading-pulse">
                                <div className="text-blue-400 text-xl font-bold mb-2">正在連線至 GitHub 資料庫...</div>
                                <p className="text-slate-500">解析 XLSX 檔案中</p>
                            </div>
                        )}

                        {error && (
                            <div className="bg-red-900/20 border border-red-500/50 p-6 rounded-xl text-center max-w-2xl mx-auto mt-10">
                                <div className="text-red-400 text-lg font-bold mb-2">系統連線錯誤</div>
                                <p className="text-red-200/70 mb-4">{error}</p>
                                <button onClick={loadAllData} className="px-4 py-2 bg-red-800 hover:bg-red-700 text-white rounded-lg transition-colors">重試連線</button>
                            </div>
                        )}

                        {/* 儀表板數據 */}
                        {!loading && !error && (
                            <>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                    {[
                                        { l: "追蹤個股總數", v: uniqueStocks.length, c: "border-blue-500", icon: "search" },
                                        { l: "深度報告總量", v: data.reports.length, c: "border-emerald-500", icon: "fileText" },
                                        { l: "外電消息總量", v: data.news.length, c: "border-purple-500", icon: "trendingUp" },
                                        { l: "Rex 關注標的", v: data.reports.filter(r => r['Rex觀察']).length, c: "border-indigo-500", icon: "star" }
                                    ].map((stat, i) => (
                                        <div key={i} className={`glass-panel p-4 rounded-xl border-t-4 ${stat.c} flex flex-col justify-between`}>
                                            <div className="text-slate-500 text-xs font-bold uppercase tracking-wider mb-2">{stat.l}</div>
                                            <div className="text-3xl font-black text-white">{stat.v}</div>
                                        </div>
                                    ))}
                                </div>

                                {/* 股票卡片網格 */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {filteredStocks.map(code => {
                                        const industry = data.industry.find(i => String(i['代號']) === code) || {};
                                        const latestRep = data.reports.find(r => String(r['股號']) === code);
                                        const latestNews = data.news.find(n => String(n['股號']) === code);
                                        const name = industry['名稱'] || latestRep?.['公司'] || latestNews?.['公司'] || '未知';

                                        if (!latestRep && !industry['產業'] && !latestNews) return null;

                                        return (
                                            <div key={code} 
                                                 onClick={() => setSelectedStock(code)}
                                                 className="glass-panel rounded-xl p-5 hover:bg-[#1e293b] hover:border-blue-500/50 transition-all cursor-pointer group relative overflow-hidden flex flex-col h-full">
                                                
                                                {/* 背景光暈 */}
                                                <div className="absolute -top-10 -right-10 w-32 h-32 bg-blue-500/5 rounded-full blur-3xl group-hover:bg-blue-500/10 transition-all duration-500"></div>

                                                <div className="relative z-10">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <div>
                                                            <div className="flex items-baseline gap-2">
                                                                <span className="text-2xl font-black text-white tracking-tight">{code}</span>
                                                                <span className="text-lg text-slate-400 font-medium">{name}</span>
                                                            </div>
                                                            <div className="text-xs text-slate-500 mt-1 flex flex-wrap gap-2">
                                                                {industry['產業'] && <span className="bg-slate-800 border border-slate-700 px-2 py-0.5 rounded">{industry['產業']}</span>}
                                                                {industry['細產業'] && <span className="text-slate-600 px-1">/ {industry['細產業']}</span>}
                                                            </div>
                                                        </div>
                                                        {latestRep && (
                                                            <div className="text-right">
                                                                <div className={`text-sm font-bold px-2 py-1 rounded ${latestRep['投資評等']?.includes('Buy') ? 'bg-red-900/30 text-red-400 border border-red-500/30' : 'bg-yellow-900/30 text-yellow-400 border border-yellow-500/30'}`}>
                                                                    {latestRep['投資評等']?.substring(0, 8)}
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>

                                                    <div className="space-y-3 mt-4 flex-1">
                                                        {industry['產業地位'] && (
                                                            <p className="text-slate-400 text-xs line-clamp-2 bg-slate-900/50 p-2 rounded border border-slate-800">
                                                                {industry['產業地位']}
                                                            </p>
                                                        )}
                                                        
                                                        {latestRep ? (
                                                            <div className="flex gap-2">
                                                                <div className="min-w-[3px] bg-blue-500 rounded-full"></div>
                                                                <p className="text-sm text-slate-300 line-clamp-2 leading-relaxed">{latestRep['精簡重點摘要']}</p>
                                                            </div>
                                                        ) : latestNews ? (
                                                            <div className="flex gap-2">
                                                                <div className="min-w-[3px] bg-purple-500 rounded-full"></div>
                                                                <p className="text-sm text-slate-300 line-clamp-2 leading-relaxed">{latestNews['報導重點分類']} - {latestNews['完整報導內容']}</p>
                                                            </div>
                                                        ) : null}
                                                    </div>
                                                </div>

                                                <div className="mt-4 pt-3 border-t border-slate-700/50 flex justify-between items-center relative z-10">
                                                    <span className="text-[10px] text-slate-600 font-bold uppercase tracking-wider group-hover:text-blue-400 transition-colors">View Analysis</span>
                                                    {latestRep?.['Rex觀察'] && <span className="text-xs text-indigo-400 font-bold flex items-center gap-1 bg-indigo-900/20 px-2 py-0.5 rounded-full border border-indigo-500/20"><Icon name="star" size={10}/> Rex 關注</span>}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </>
                        )}
                    </main>

                    {/* 彈窗 */}
                    {selectedStock && (
                        <StockDetailView 
                            stockCode={selectedStock} 
                            industryData={data.industry} 
                            reportsData={data.reports} 
                            newsData={data.news} 
                            onClose={() => setSelectedStock(null)} 
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
